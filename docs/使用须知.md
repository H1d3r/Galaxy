# 使用须知

1. 在第一次导入Jar包时，会在用户目录下生成`.galaxy`文件夹，并创建项目所需要的文件/路径，[简介](#工作路径简介)
2. 该项目UI仅提供一个按钮`reload`，每次修改`config.yaml`都需要reload,  [简介](#配置简介)
3. 该项目倾向于写一些表达式来代替繁琐的配置，表达式相关的基础能力介绍见[简介](#基础能力)。

# 工作路径简介

```
+ dict // 字典，可copy 项目下的同名字典
  | bypassUrlDict.txt // 用于 Bypass Url 的字典
  | fuzzSensitivePathDict.txt // 用于 Bypass Path 的字典，可参考dirsearch
+ extract // 存放该项目提取出的文件
+ tmp // 存放临时文件，会在burp关闭时自动删除
| config.yaml // 配置文件
| Hook.java // 用于Http流量Hook功能中JAVA的脚本存放
```

# 配置简介

```yaml
cloudConfig: # 不同云的配置
  awsConfig:
    ak: ''
    region: ''
    service: s3
    sk: ''
    token: ''
httpTrafficAutoModificationConfig: # HTTP流量自动修改相关的配置
  decorateConfig: # 利用表达式引擎对请求和响应做一些简单的修改
    requestModifyExpression: ''
    responseModifyExpression: ''
  hookConfig: # 完成四个生命周期HTTP请求或响应的修改
    hookService: JAVA # hook所使用的sevice, 有RPC、JAVA
    javaFilePath: C:\Users\outlaws\.galaxy\Hook.java # 当service为JAVA时的java或class文件
    requestIsNeedHook: true # 请求是否需要被Hook的开关
    responseIsNeedHook: true # 响应是否需要被Hook的开关
    requestMatchExpression: 'request.getHost().equals("192.168.1.4")' # 请求是否需要被Hook的表达式
    rpcConn: 127.0.0.1:8443
  ruleMatchConfig: # 使用不同的匹配规则计算score
    requestParamMatches: {}
    responseContentMatches: {}
    responseHeaderMatches: {}
mixedConfig:
  sqlMapConfig: # 配置SQLMAP的文件路径及默认运行参数
    arg: --force-ssl --risk=3 --level=3
    path: sqlmap
payloadConfig: {} # payload, Map<String, Object>, Object可以是String, List, Map，会自动逐级生成Menu和MenuIte
```

# 基础能力

## 表达式渲染

```java
Request request = Request.of("https://www.baidu.com");
String template = "request.host";

HashMap<String, Object> env = new HashMap<>();
env.put("request", request);

String res = Render.renderExpression(template, env);
// www.baidu.com
```

## 字符串渲染

引擎会将${expression}中的expression当作表达式执行再渲染，当$需要作为其本身使用时，需要双写转义

```java
URL originUrl = new URL("https://www.baidu.com");
URL evilUrl = new URL("https://www.evil.com");
String template = "${request.protocol}://${evilUrl.host}%ff.${request.host}";

HashMap<String, Object> env = new HashMap<>();
env.put("originUrl", originUrl);
env.put("evilUrl", originUrl);

String res = Render.renderTemplate("${request.protocol}://${evilUrl.host}%ff.${request.host}", env);
// https://www.evil.com%ff.www.baidu.com
```
